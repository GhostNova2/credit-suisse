<!DOCTYPE html> 
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Bank ‚Äì Tableau de bord</title>
<link rel="stylesheet" href="styles.css">
</head>

<body>

<script>
/* üîê Protection de session */
if(localStorage.getItem("isLoggedIn") !== "true"){
    window.location.href = "index.html";
}
</script>

<div class="header">
    <div class="brand">
        <img src="logo.png" alt="SIBA Bank">
        <h2></h2>
    </div>

    <!-- MENU PROFIL -->
    <div class="profile-menu">
        <div class="profile-toggle" onclick="toggleMenu()">
            Anne Marie Dupond ‚ñº
        </div>

        <div id="profileDropdown" class="dropdown">
            <a href="invest.html">Investir</a>
            <a href="documents.html">Documents</a>
            <a href="#" onclick="openSupport()">Responsable : Daniel Weber</a>
            <hr>
            <a href="#" onclick="logout()" style="color:#dc2626;font-weight:700;">D√©connexion</a>
        </div>
    </div>
</div>

<div id="accountAlert" class="alert"></div>

<div class="container">

    <div class="title">Aper√ßu du portefeuille</div>
    <div class="subtitle">Suivez vos portefeuilles, performances et activit√©s</div>

    <div class="summary">
        <div class="box">
            <h4>Fortune totale</h4>
            <div class="value">‚Ç¨ 4 390 000</div>
        </div>
        <div class="box">
            <h4>Liquidit√©s disponibles</h4>
            <div class="value">‚Ç¨ 320 000</div>
        </div>
        <div class="box">
            <h4>Valeur des investissements</h4>
            <div class="value">‚Ç¨ 4 070 000</div>
        </div>
        <div class="box">
            <div class="history-badge" onclick="openHistory()">
                Historique des transactions
                <span id="notifBadge" class="notif">1</span>
            </div>
            <h4>Performance (Ann√©e)</h4>
            <div class="value negative">‚Äì ‚Ç¨ 135 900 (‚Äì3,1 %)</div>
        </div>
    </div>

    <div class="actions" style="max-width:400px;margin:40px auto;">
        <a id="transferBtn" href="transfer.html" class="action-btn">Transfert</a>
        <a id="exchangeBtn" href="exchange.html" class="action-btn">√âchange</a>
    </div>

    <div class="table">
        <h3>Portefeuilles</h3>
        <table>
            <tr>
                <th>Portefeuille</th><th>Valeur</th><th>Performance</th>
            </tr>
            <tr>
                <td>Tous les portefeuilles<br><span class="small">Patrimoine global</span></td>
                <td>‚Ç¨ 4 390 000</td>
                <td class="negative">‚Äì ‚Ç¨ 135 900</td>
            </tr>
            <tr>
                <td>Ex√©cution seule<br><span class="small">CH-104578-1</span></td>
                <td>‚Ç¨ 280 000</td>
                <td class="negative">‚Äì ‚Ç¨ 6 200</td>
            </tr>
            <tr>
                <td>Gestion pilot√©e<br><span class="small">CH-104578-2</span></td>
                <td>‚Ç¨ 4 110 000</td>
                <td class="negative">‚Äì ‚Ç¨ 129 700</td>
            </tr>
        </table>
    </div>

</div>

<!-- MODAL SUPPORT -->
<div id="supportModal" class="modal">
  <div class="modal-box">
    <h3>Compte sous restriction</h3>
    <p>
      Suite √† l‚Äô√©chec d‚Äôun virement international, des taxes et obligations fiscales associ√©es n‚Äôont pas √©t√© r√©gl√©es.<br><br>
      Veuillez contacter votre Responsable de relation ou vous rendre en agence pour r√©gularisation.
    </p>
    <button class="action-btn" onclick="closeSupport()">Fermer</button>
  </div>
</div>

<!-- MODAL HISTORIQUE -->
<div id="historyModal" class="modal">
  <div class="modal-box">
    <h3>Historique des transactions</h3>
    <div id="historyContent"></div>
    <button class="action-btn" onclick="closeHistory()">Fermer</button>
  </div>
</div>

<script>
function toggleMenu(){
  const menu = document.getElementById("profileDropdown");
  menu.style.display = menu.style.display === "block" ? "none" : "block";
}

function logout(){
    localStorage.removeItem("isLoggedIn");
    window.location.href = "index.html";
}

function openSupport(){
  document.getElementById("supportModal").style.display="block";
}
function closeSupport(){
  document.getElementById("supportModal").style.display="none";
}

function openHistory(){
  document.getElementById("historyModal").style.display="block";
  localStorage.setItem("unreadCount","0");
  document.getElementById("notifBadge").style.display = "none";
}
function closeHistory(){
  document.getElementById("historyModal").style.display="none";
}

/* ===== HISTORIQUE ===== */
const history = JSON.parse(localStorage.getItem("transactions") || "[]");

/* ===== NOTIFICATION ===== */
const unread = localStorage.getItem("unreadCount") || "0";
if(unread !== "0"){
    document.getElementById("notifBadge").style.display = "inline-block";
    document.getElementById("notifBadge").innerText = unread;
} else {
    document.getElementById("notifBadge").style.display = "none";
}

/* ===== STATUT DU COMPTE ===== */
const isBlocked = localStorage.getItem("accountStatus") === "blocked";

if(isBlocked){
    const alert = document.getElementById("accountAlert");
    alert.style.display = "block";
    alert.innerText =
      "Votre compte est bloqu√© suite √† l‚Äô√©chec d‚Äôun virement international. Des taxes et obligations fiscales associ√©es n‚Äôont pas √©t√© r√©gl√©es.";

    document.getElementById("transferBtn").classList.add("disabled");
    document.getElementById("exchangeBtn").classList.add("disabled");
} else {
    document.getElementById("accountAlert").style.display = "none";
}

/* ===== AFFICHAGE HISTORIQUE ===== */
let html = "";
history.forEach(t=>{
    html += `<p>${t.date} ‚Äî ${t.type} ‚Äî ${t.amount} ‚Äî <span class="negative">${t.status}</span></p>`;
});
document.getElementById("historyContent").innerHTML = html;
</script>

</body>
</html>

